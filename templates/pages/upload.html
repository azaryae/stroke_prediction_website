{% extends 'layoutes/master.html' %}

{% block title %}Upload - My Website{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center mt-5">
        <div class="col-md-6 mb-4 mx-auto">
            <div class="card border-0 shadow-lg p-3 mb-5 bg-white rounded">
                <div class="card-body">
                    <h2 class="card-title text-center mb-4">Upload Your Dataset</h2>
                    <form id="uploadForm" method="POST" enctype="multipart/form-data" action="{{ url_for('upload') }}">
                        <div class="form-group row">
                            <label for="file" class="col-sm-6 col-form-label">Choose file:</label>
                            <div class="col-sm-6">
                                <div class="input-group">
                                    <input type="file" class="form-control-file" id="file" name="file" onchange="showFileName(this)">
                                    <div class="input-group-append" id="clearBtnWrapper" style="display: none;">
                                        <button type="button" class="btn btn-danger" id="clearBtn" onclick="clearFile()">Clear</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="fileName" class="col-sm-6 col-form-label" style="margin-bottom: 0;">File selected:</label>
                            <div class="col-sm-6" style="margin-bottom: 10px;">
                                <span id="fileName" class="form-control" style="display: none;">None</span>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-sm-6"></div>
                            <div class="col-sm-6">
                                <button type="submit" class="btn btn-primary btn-block mt-4" id="uploadBtn" style="display: none;">Upload</button>
                                <button type="button" class="btn btn-success btn-block mt-4" id="downloadBtn" style="display: none;">Download</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add some custom CSS for extra flair -->
<style>
    .card {
        background-color: #f8f9fa; /* Light gray background */
    }

    .card-body {
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Soft shadow */
    }

    .btn-primary {
        background-color: #ff6b6b; /* Vivid red */
        border-color: #ff6b6b; /* Matching border color */
    }

    .btn-primary:hover {
        background-color: #ff4d4d; /* Darker red on hover */
        border-color: #ff4d4d;
    }

    .btn-success {
        background-color: #28a745; /* Dark green */
        border-color: #28a745;
    }

    .btn-success:hover {
        background-color: #218838; /* Darker green on hover */
        border-color: #218838;
    }

    .btn-danger {
        background-color: #dc3545; /* Dark red */
        border-color: #dc3545;
    }

    .btn-danger:hover {
        background-color: #c82333; /* Darker red on hover */
        border-color: #c82333;
    }
</style>

<!-- JavaScript to handle file selection, clearing, and animation on form submission -->
<script>
    function showFileName(input) {
        const fileName = input.files[0].name;
        const clearBtnWrapper = document.getElementById("clearBtnWrapper");
        const fileNameSpan = document.getElementById("fileName");
        const uploadBtn = document.getElementById("uploadBtn");
        const downloadBtn = document.getElementById("downloadBtn");
        if (fileName) {
            clearBtnWrapper.style.display = "inline-block";
            fileNameSpan.innerText = fileName;
            fileNameSpan.style.display = "inline-block";
            uploadBtn.style.display = "inline-block";
            downloadBtn.style.display = "inline-block"; // Show the download button
            downloadBtn.setAttribute("href", "#"); // Set href attribute to '#' temporarily
            input.style.display = "none";
        } else {
            clearBtnWrapper.style.display = "none";
            fileNameSpan.innerText = "None";
            fileNameSpan.style.display = "inline-block";
            uploadBtn.style.display = "none";
            downloadBtn.style.display = "none"; // Hide the download button
            input.style.display = "inline-block";
        }
    }

    function clearFile() {
        const fileInput = document.getElementById("file");
        fileInput.value = ""; // Clear the selected file
        const clearBtnWrapper = document.getElementById("clearBtnWrapper");
        const fileNameSpan = document.getElementById("fileName");
        const uploadBtn = document.getElementById("uploadBtn");
        const downloadBtn = document.getElementById("downloadBtn");
        clearBtnWrapper.style.display = "none"; // Hide the clear button
        fileNameSpan.innerText = "None";
        fileNameSpan.style.display = "inline-block";
        uploadBtn.style.display = "none";
        downloadBtn.style.display = "none"; // Hide the download button
        fileInput.style.display = "inline-block"; // Show the file input button again
    }

    function downloadDataset() {
        const fileInput = document.getElementById("file");
        const file = fileInput.files[0];
        const fileName = file.name;

        if (file) {
            const blob = new Blob([file], { type: file.type });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }
    }

    // Function to handle download button click
    document.getElementById("downloadBtn").addEventListener("click", function(event) {
        event.preventDefault();
        downloadDataset();
    });

    // Add animation on form submission
    document.getElementById("uploadForm").addEventListener("submit", function(event) {
        event.preventDefault();
        const form = this;
        form.classList.add("animated", "fadeOut");
        setTimeout(() => {
            form.submit();
        }, 500); // Adjust the time to match the animation duration
    });
</script>
{% endblock %}
